<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AniPick Admin â€“ ë²„ì „ ê´€ë¦¬</title>

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #50C8B8;
      --primary-light: #6dd4c7;
      --text-primary: #1f2937;
      --bg-page: #f5f6f8;
      --bg-card: #ffffff;
      --border-light: #e5e7eb;
      --shadow-medium: 0 10px 30px rgba(0,0,0,0.12);
      --radius: 16px;
      --transition: all .25s ease;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: "Noto Sans KR", sans-serif; background: var(--bg-page); }

    header {
      position: fixed; inset: 0 0 auto 0; height: 64px;
      background: white; border-bottom: 1px solid rgba(0,0,0,0.06);
      z-index: 20;
    }

    .header-container {
      max-width: 1100px; margin: 0 auto; padding: 0 20px;
      height: 100%; display: flex; align-items: center; justify-content: space-between;
    }

    .logo { display: flex; align-items: center; gap: 10px; font-weight: 900; color: var(--text-primary); text-decoration: none; }
    .logo img { width: 32px; }

    .menu-btn {
      width: 32px; height: 22px; background: none; border: none;
      display: flex; flex-direction: column; justify-content: space-between; cursor: pointer;
    }
    .menu-btn span { height: 3px; background: var(--text-primary); border-radius: 2px; }

    .menu-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.45);
      opacity: 0; visibility: hidden; transition: var(--transition); z-index: 30;
    }
    .menu-overlay.show { opacity: 1; visibility: visible; }

    .side-menu {
      position: fixed; top: 0; right: -280px; width: 280px; height: 100%;
      background: white; padding: 24px;
      box-shadow: -10px 0 30px rgba(0,0,0,0.15);
      transition: var(--transition); z-index: 40;
    }
    .side-menu.show { right: 0; }
    .side-menu h3 { font-size: 18px; margin-bottom: 20px; }
    .side-menu a {
      display: block; padding: 14px; border-radius: 12px;
      background: rgba(80,200,184,.12);
      color: var(--primary); font-weight: 700; text-decoration: none;
    }

    .admin-container {
      max-width: 900px; margin: 120px auto;
      background: var(--bg-card); padding: 36px;
      border-radius: var(--radius); box-shadow: var(--shadow-medium);
    }

    .tab-bar { display: flex; gap: 10px; margin-bottom: 32px; }
    .tab {
      padding: 10px 18px; border-radius: 999px; border: 1px solid var(--border-light);
      cursor: pointer; font-weight: 800; background: white;
    }
    .tab.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white; border: none;
    }

    .admin-title { font-size: 26px; font-weight: 900; margin-bottom: 32px; }

    .form-group { margin-bottom: 22px; }
    label { font-weight: 700; display: block; margin-bottom: 8px; }

    input, textarea {
      width: 100%; padding: 12px;
      border-radius: 10px; border: 1px solid var(--border-light);
    }
    /* Readonly style */
    input:read-only, textarea:read-only {
      background-color: #f9fafb;
      color: #6b7280;
      border-color: #e5e7eb;
    }

    .version-row { display: flex; gap: 10px; align-items: center; }
    .version-row input { width: 80px; text-align: center; }
    .version-row span { font-weight: 900; }

    .btn-group { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn {
      padding: 10px 18px; border-radius: 999px;
      border: 1px solid var(--border-light); background: white; cursor: pointer;
      transition: var(--transition);
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,.08); }
    .btn.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-light));
      color: white; border: none;
      box-shadow: 0 6px 16px rgba(0,0,0,.12);
    }

    .submit-btn {
      margin-top: 32px; width: 100%; padding: 16px;
      border-radius: 14px; border: none;
      font-size: 16px; font-weight: 800;
      color: white; background: linear-gradient(135deg, var(--primary), var(--primary-light));
      cursor: pointer;
    }

    .version-list { margin-top: 24px; border-top: 1px solid var(--border-light); }
    .version-item {
      padding: 14px; border-bottom: 1px solid var(--border-light);
      cursor: pointer;
      display: flex; justify-content: space-between; align-items: center;
      gap: 10px;
    }
    .version-item:hover { background: rgba(0,0,0,0.04); }
    .meta { color: #6b7280; font-size: 13px; font-weight: 700; }

    .hidden { display: none !important; }

    /* ---------- DETAIL MODAL ---------- */
    .detail-modal {
      position: fixed; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 520px; max-width: calc(100vw - 32px);
      max-height: 80vh; overflow-y: auto;
      background: white; padding: 28px;
      border-radius: 16px; z-index: 50;
      box-shadow: var(--shadow-medium);
      display: none;
    }
    .detail-modal.show { display: block; }

    /* Modal Header */
    .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .modal-title { font-size: 18px; font-weight: 900; }

    /* Mode Badge */
    .mode-badge {
      padding: 6px 12px; border-radius: 999px; font-size: 12px; font-weight: 900;
    }
    .mode-badge.read { background: #e5e7eb; color: #374151; }
    .mode-badge.edit { background: #50C8B8; color: white; }

    .danger { background: #ef4444; color: white; border: none; }
    .danger:hover { background: #dc2626; }
    .muted { color: #6b7280; font-size: 13px; font-weight: 700; margin-bottom: 14px; }

  </style>
</head>

<body>

<script>
  const adminAccessToken = sessionStorage.getItem("ADMIN_ACCESS_TOKEN");
  if (!adminAccessToken) {
    alert("ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.");
    location.href = "/admin-login.html";
  }
</script>

<header>
  <div class="header-container">
    <a class="logo" href="/admin-version.html">
      <img src="/image/anipick_logo.png" alt="AniPick Admin"> AniPick Admin
    </a>
    <button id="menuBtn" class="menu-btn" type="button">
      <span></span><span></span><span></span>
    </button>
  </div>
</header>

<div id="overlay" class="menu-overlay"></div>
<div id="sideMenu" class="side-menu">
  <h3>ê´€ë¦¬ì ë©”ë‰´</h3>
  <a href="/admin-version.html">ğŸ›  ë²„ì „ ê´€ë¦¬</a>
</div>

<div class="admin-container">

  <div class="tab-bar">
    <div id="tabCreate" class="tab active">ë²„ì „ ë“±ë¡</div>
    <div id="tabList" class="tab">ë²„ì „ ì¡°íšŒ</div>
  </div>

  <section id="createSection">
    <h1 class="admin-title">ë²„ì „ ë“±ë¡</h1>

    <div class="form-group">
      <label>í”Œë«í¼</label>
      <div class="btn-group" id="platformBtns">
        <button class="btn active" type="button">ANDROID</button>
        <button class="btn" type="button">IOS</button>
      </div>
    </div>

    <div class="form-group">
      <label>ë²„ì „</label>
      <div class="version-row">
        <input id="major" type="number" min="0" required placeholder="0">
        <span>.</span>
        <input id="minor" type="number" min="0" required placeholder="0">
        <span>.</span>
        <input id="patch" type="number" min="0" required placeholder="0">
      </div>
    </div>

    <div class="form-group">
      <label>í•„ìˆ˜ ì—¬ë¶€</label>
      <div class="btn-group" id="importantBtns">
        <button class="btn active" type="button">í•„ìˆ˜</button>
        <button class="btn" type="button">ì„ íƒ</button>
      </div>
    </div>

    <div class="form-group">
      <label>íƒ€ì…</label>
      <div class="btn-group" id="typeBtns">
        <button class="btn active" type="button">ì—…ë°ì´íŠ¸</button>
        <button class="btn" type="button">ê³µì§€ì‚¬í•­</button>
      </div>
    </div>

    <div class="form-group">
      <label>URL</label>
      <input id="url" required placeholder="https://...">
    </div>

    <div class="form-group">
      <label>ì œëª©</label>
      <input id="title" required>
    </div>

    <div class="form-group">
      <label>ë‚´ìš©</label>
      <textarea id="content" rows="5" required></textarea>
    </div>

    <button id="submitBtn" class="submit-btn" type="button">ë²„ì „ ë“±ë¡</button>
  </section>

  <section id="listSection" class="hidden">
    <h1 class="admin-title">ë²„ì „ ì¡°íšŒ</h1>

    <div class="form-group">
      <label>í”Œë«í¼ (í•„ìˆ˜)</label>
      <div class="btn-group" id="listPlatformBtns">
        <button class="btn active" type="button">ANDROID</button>
        <button class="btn" type="button">IOS</button>
      </div>
    </div>

    <div class="form-group">
      <label>íƒ€ì… (ì„ íƒ)</label>
      <div class="btn-group" id="listTypeBtns">
        <button class="btn active" type="button">ì „ì²´</button>
        <button class="btn" type="button">ì—…ë°ì´íŠ¸</button>
        <button class="btn" type="button">ê³µì§€ì‚¬í•­</button>
      </div>
    </div>

    <button id="searchBtn" class="submit-btn" type="button">ì¡°íšŒ</button>

    <div id="versionList" class="version-list"></div>
  </section>

</div>

<div id="detailOverlay" class="menu-overlay"></div>
<div id="detailModal" class="detail-modal">

  <div class="modal-header">
    <div class="modal-title">ë²„ì „ ìƒì„¸</div>
    <div id="modeBadge" class="mode-badge read">READ</div>
  </div>

  <div class="muted" id="dMeta"></div>

  <div id="readOnlyView">
    <div class="form-group">
      <label>ë²„ì „</label>
      <input id="rVersion" readonly>
    </div>
    <div class="form-group">
      <label>í”Œë«í¼</label>
      <input id="rPlatform" readonly>
    </div>
    <div class="form-group">
      <label>íƒ€ì…</label>
      <input id="rType" readonly>
    </div>
    <div class="form-group">
      <label>í•„ìˆ˜ ì—¬ë¶€</label>
      <input id="rImportant" readonly>
    </div>
    <div class="form-group">
      <label>URL</label>
      <input id="rUrl" readonly>
    </div>
    <div class="form-group">
      <label>ì œëª©</label>
      <input id="rTitle" readonly>
    </div>
    <div class="form-group">
      <label>ë‚´ìš©</label>
      <textarea id="rContent" rows="6" readonly></textarea>
    </div>
  </div>

  <div id="editOnlyView" class="hidden">
    <div class="form-group">
      <label>í”Œë«í¼</label>
      <div class="btn-group" id="editPlatformBtns">
        <button class="btn" type="button">ANDROID</button>
        <button class="btn" type="button">IOS</button>
      </div>
    </div>

    <div class="form-group">
      <label>ë²„ì „</label>
      <div class="version-row">
        <input id="eMajor" type="number" min="0" placeholder="0">
        <span>.</span>
        <input id="eMinor" type="number" min="0" placeholder="0">
        <span>.</span>
        <input id="ePatch" type="number" min="0" placeholder="0">
      </div>
    </div>

    <div class="form-group">
      <label>í•„ìˆ˜ ì—¬ë¶€</label>
      <div class="btn-group" id="editImportantBtns">
        <button class="btn" type="button">í•„ìˆ˜</button>
        <button class="btn" type="button">ì„ íƒ</button>
      </div>
    </div>

    <div class="form-group">
      <label>íƒ€ì…</label>
      <div class="btn-group" id="editTypeBtns">
        <button class="btn" type="button">ì—…ë°ì´íŠ¸</button>
        <button class="btn" type="button">ê³µì§€ì‚¬í•­</button>
      </div>
    </div>

    <div class="form-group">
      <label>URL</label>
      <input id="eUrl">
    </div>

    <div class="form-group">
      <label>ì œëª©</label>
      <input id="eTitle">
    </div>

    <div class="form-group">
      <label>ë‚´ìš©</label>
      <textarea id="eContent" rows="6"></textarea>
    </div>
  </div>

  <div class="btn-group" style="margin-top: 24px;">
    <button id="editBtn" class="btn active" type="button" style="flex:1;">ìˆ˜ì •</button>
    <button id="deleteBtn" class="btn danger" type="button">ì‚­ì œ</button>
  </div>
</div>


<script>
  // === STATE ===
  let selectedPlatform = "ANDROID";
  let selectedImportantYn = 1;
  let selectedType = "update";

  let listPlatform = "ANDROID";
  let listType = null; // null=ì „ì²´

  let currentVersionId = null;
  let isEditMode = false; // í˜„ì¬ ìˆ˜ì • ëª¨ë“œì¸ì§€ ì—¬ë¶€

  // === DOM ELEMENTS ===
  const $ = (id) => document.getElementById(id);

  // Create Section
  const platformBtns = $("platformBtns");
  const importantBtns = $("importantBtns");
  const typeBtns = $("typeBtns");
  const major = $("major"), minor = $("minor"), patch = $("patch");
  const url = $("url"), title = $("title"), content = $("content");
  const submitBtn = $("submitBtn");

  // List Section
  const listPlatformBtns = $("listPlatformBtns");
  const listTypeBtns = $("listTypeBtns");
  const searchBtn = $("searchBtn");
  const versionList = $("versionList");

  // Tabs & Sections
  const tabCreate = $("tabCreate");
  const tabList = $("tabList");
  const createSection = $("createSection");
  const listSection = $("listSection");

  // Menu & Modal
  const menuBtn = $("menuBtn");
  const sideMenu = $("sideMenu");
  const overlay = $("overlay");
  const detailOverlay = $("detailOverlay");
  const detailModal = $("detailModal");

  // Detail Modal Elements
  const dMeta = $("dMeta");
  const modeBadge = $("modeBadge");
  const readOnlyView = $("readOnlyView");
  const editOnlyView = $("editOnlyView");
  const editBtn = $("editBtn");
  const deleteBtn = $("deleteBtn");

  // Read Inputs
  const rVersion = $("rVersion");
  const rPlatform = $("rPlatform");
  const rType = $("rType");
  const rImportant = $("rImportant");
  const rUrl = $("rUrl");
  const rTitle = $("rTitle");
  const rContent = $("rContent");

  // Edit Inputs & Groups
  const eMajor = $("eMajor");
  const eMinor = $("eMinor");
  const ePatch = $("ePatch");
  const eUrl = $("eUrl");
  const eTitle = $("eTitle");
  const eContent = $("eContent");
  const editPlatformBtns = $("editPlatformBtns");
  const editImportantBtns = $("editImportantBtns");
  const editTypeBtns = $("editTypeBtns");


  // === EVENT BINDING FUNCTIONS ===
  function toggleGroup(groupEl, callback) {
    groupEl.querySelectorAll(".btn").forEach(btn => {
      btn.addEventListener("click", () => {
        groupEl.querySelectorAll(".btn").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        if (callback) callback(btn.innerText.trim());
      });
    });
  }

  // Helper to programmatically set active button
  function setActiveBtn(groupEl, textToMatch) {
    groupEl.querySelectorAll(".btn").forEach(btn => {
      if(btn.innerText.trim() === textToMatch) {
        btn.classList.add("active");
      } else {
        btn.classList.remove("active");
      }
    });
  }

  // Helper to get active button text
  function getActiveBtnText(groupEl) {
    const active = groupEl.querySelector(".btn.active");
    return active ? active.innerText.trim() : "";
  }


  // === INITIALIZE GROUPS ===
  // Create Section Groups
  toggleGroup(platformBtns, v => selectedPlatform = v);
  toggleGroup(importantBtns, v => selectedImportantYn = (v === "í•„ìˆ˜" ? 1 : 0));
  toggleGroup(typeBtns, v => selectedType = (v === "ì—…ë°ì´íŠ¸" ? "update" : "notice"));

  // List Section Groups
  toggleGroup(listPlatformBtns, v => listPlatform = v);
  toggleGroup(listTypeBtns, v => {
    if (v === "ì „ì²´") listType = null;
    else listType = (v === "ì—…ë°ì´íŠ¸" ? "update" : "notice");
  });

  // Edit Section Groups (No global state update needed here, we pull from DOM on save)
  toggleGroup(editPlatformBtns);
  toggleGroup(editImportantBtns);
  toggleGroup(editTypeBtns);


  // === TAB LOGIC ===
  tabCreate.addEventListener("click", () => {
    tabCreate.classList.add("active");
    tabList.classList.remove("active");
    createSection.classList.remove("hidden");
    listSection.classList.add("hidden");
  });

  tabList.addEventListener("click", () => {
    tabList.classList.add("active");
    tabCreate.classList.remove("active");
    listSection.classList.remove("hidden");
    createSection.classList.add("hidden");
  });


  // === MENU LOGIC ===
  menuBtn.addEventListener("click", () => {
    sideMenu.classList.add("show");
    overlay.classList.add("show");
  });
  overlay.addEventListener("click", () => {
    sideMenu.classList.remove("show");
    overlay.classList.remove("show");
  });


  // === MODAL LOGIC ===
  function closeDetailModal() {
    detailOverlay.classList.remove("show");
    detailModal.classList.remove("show");
    // ëª¨ë‹¬ ë‹«ì„ ë•Œ ìƒíƒœ ì´ˆê¸°í™”
    isEditMode = false;
  }
  detailOverlay.addEventListener("click", closeDetailModal);


  // === SUBMIT (CREATE) ===
  submitBtn.addEventListener("click", async () => {
    const requiredInputs = [major, minor, patch, url, title, content];
    if (!requiredInputs.every(el => String(el.value).trim() !== "")) {
      alert("ëª¨ë“  ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }

    const m = Number(major.value), n = Number(minor.value), p = Number(patch.value);
    if ([m, n, p].some(v => Number.isNaN(v) || v < 0)) {
      alert("ë²„ì „ì€ 0 ì´ìƒì˜ ìˆ«ìë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.");
      return;
    }

    const payload = {
      platform: selectedPlatform,
      major: m,
      minor: n,
      patch: p,
      importantYn: selectedImportantYn,
      type: selectedType,
      url: String(url.value).trim(),
      title: String(title.value).trim(),
      updatedContent: String(content.value).trim()
    };

    const res = await fetch("/api/admin/version", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": `Bearer ${adminAccessToken}`
      },
      body: JSON.stringify(payload)
    });

    let data = null;
    try { data = await res.json(); } catch (e) {}

    if (!res.ok || !data || data.code !== 200) {
      alert((data && (data.errorValue || data.errorReason)) || "ë“±ë¡ ì‹¤íŒ¨");
      return;
    }

    alert("ë²„ì „ ë“±ë¡ ì„±ê³µ");
    location.reload();
  });


  // === SEARCH (LIST) ===
  searchBtn.addEventListener("click", async () => {
    if (!listPlatform) {
      alert("í”Œë«í¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    let endpoint = `/api/admin/version?platform=${encodeURIComponent(listPlatform)}`;
    if (listType) endpoint += `&type=${encodeURIComponent(listType)}`;

    const res = await fetch(endpoint, {
      headers: { "Authorization": `Bearer ${adminAccessToken}` }
    });

    const data = await res.json();
    versionList.innerHTML = "";

    if (!res.ok || data.code !== 200) {
      alert(data.errorValue || data.errorReason || "ì¡°íšŒ ì‹¤íŒ¨");
      return;
    }

    const items = (data.result && data.result.items) ? data.result.items : [];
    if (items.length === 0) {
      const empty = document.createElement("div");
      empty.className = "version-item";
      empty.style.cursor = "default";
      empty.innerHTML = `<div>ì¡°íšŒ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      versionList.appendChild(empty);
      return;
    }

    items.forEach(item => {
      const div = document.createElement("div");
      div.className = "version-item";
      const vText = `v${item.major}.${item.minor}.${item.patch}`;
      // API may return 'update'/'notice', map to KR if needed, or show as is
      const tText = (item.type === "update" ? "ì—…ë°ì´íŠ¸" : (item.type === "notice" ? "ê³µì§€ì‚¬í•­" : item.type));
      div.innerHTML = `<div><b>${vText}</b> Â· ${tText}</div><div class="meta">ID: ${item.versionId}</div>`;
      div.addEventListener("click", () => loadDetail(item.versionId));
      versionList.appendChild(div);
    });
  });


  // === DETAIL & EDIT ===
  async function loadDetail(versionId) {
    currentVersionId = versionId;

    const res = await fetch(`/api/admin/version/${encodeURIComponent(versionId)}`, {
      headers: { "Authorization": `Bearer ${adminAccessToken}` }
    });

    const data = await res.json();
    if (!res.ok || data.code !== 200) {
      alert(data.errorValue || data.errorReason || "ìƒì„¸ ì¡°íšŒ ì‹¤íŒ¨");
      return;
    }

    const result = data.result;
    dMeta.textContent = `versionId=${result.versionId} / UpdatedAt=${result.updatedAt || '-'}`;

    // 1. READ MODE ê°’ ì„¸íŒ…
    rVersion.value = `${result.major}.${result.minor}.${result.patch}`;
    rPlatform.value = result.platform;
    rType.value = (result.type === "update" ? "ì—…ë°ì´íŠ¸" : "ê³µì§€ì‚¬í•­");
    rImportant.value = (result.importantYn === 1 ? "í•„ìˆ˜" : "ì„ íƒ");
    rUrl.value = result.url;
    rTitle.value = result.title;
    rContent.value = result.updatedContent;

    // 2. EDIT MODE ì´ˆê¸° ê°’ ì„¸íŒ… (ë¯¸ë¦¬ ì±„ì›Œë‘ê¸°)
    eMajor.value = result.major;
    eMinor.value = result.minor;
    ePatch.value = result.patch;
    eUrl.value = result.url;
    eTitle.value = result.title;
    eContent.value = result.updatedContent;

    // ë²„íŠ¼ ê·¸ë£¹ ìƒíƒœ ë™ê¸°í™”
    setActiveBtn(editPlatformBtns, result.platform); // ANDROID or IOS
    setActiveBtn(editImportantBtns, result.importantYn === 1 ? "í•„ìˆ˜" : "ì„ íƒ");
    setActiveBtn(editTypeBtns, result.type === "update" ? "ì—…ë°ì´íŠ¸" : "ê³µì§€ì‚¬í•­");


    // 3. UI ì´ˆê¸°í™” (Read ëª¨ë“œë¡œ ì‹œì‘)
    isEditMode = false;
    readOnlyView.classList.remove("hidden");
    editOnlyView.classList.add("hidden");

    modeBadge.textContent = "READ";
    modeBadge.className = "mode-badge read";

    editBtn.textContent = "ìˆ˜ì •";

    // ëª¨ë‹¬ ì—´ê¸°
    detailOverlay.classList.add("show");
    detailModal.classList.add("show");
  }


  // === EDIT / SAVE BUTTON CLICK ===
  editBtn.onclick = async () => {
    // [1] ìˆ˜ì • ëª¨ë“œë¡œ ì§„ì…
    if (!isEditMode) {
      isEditMode = true;

      // ë·° êµì²´
      readOnlyView.classList.add("hidden");
      editOnlyView.classList.remove("hidden");

      // ë°°ì§€ ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
      modeBadge.textContent = "EDIT";
      modeBadge.className = "mode-badge edit";
      editBtn.textContent = "ì €ì¥";

      return;
    }

    // [2] ì €ì¥ ë¡œì§ (ì´ë¯¸ Edit Modeì¸ ê²½ìš°)
    const maj = Number(eMajor.value);
    const min = Number(eMinor.value);
    const pat = Number(ePatch.value);

    if ([maj, min, pat].some(v => Number.isNaN(v) || v < 0)) {
      alert("ë²„ì „ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. (0 ì´ìƒì˜ ì •ìˆ˜ ì…ë ¥)");
      return;
    }

    // ë²„íŠ¼ ê·¸ë£¹ì—ì„œ ì„ íƒëœ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
    const pText = getActiveBtnText(editPlatformBtns); // ANDROID or IOS
    const iText = getActiveBtnText(editImportantBtns); // í•„ìˆ˜ or ì„ íƒ
    const tText = getActiveBtnText(editTypeBtns); // ì—…ë°ì´íŠ¸ or ê³µì§€ì‚¬í•­

    if (!pText || !iText || !tText) {
      alert("í”Œë«í¼, íƒ€ì…, í•„ìˆ˜ì—¬ë¶€ë¥¼ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
      return;
    }

    const payload = {
      platform: pText,
      major: maj,
      minor: min,
      patch: pat,
      importantYn: (iText === "í•„ìˆ˜" ? 1 : 0),
      type: (tText === "ì—…ë°ì´íŠ¸" ? "update" : "notice"),
      url: eUrl.value.trim(),
      title: eTitle.value.trim(),
      updatedContent: eContent.value.trim()
    };

    try {
      const res = await fetch(`/api/admin/version/${currentVersionId}`, {
        method: "PATCH",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${adminAccessToken}`
        },
        body: JSON.stringify(payload)
      });

      const data = await res.json();

      if (!res.ok || data.code !== 200) {
        alert((data && data.errorValue) || "ìˆ˜ì • ì‹¤íŒ¨");
        return;
      }

      alert("ìˆ˜ì • ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");

      // ì €ì¥ í›„ ë‹¤ì‹œ ìƒì„¸ ì¡°íšŒ(Read Mode)ë¡œ ê°±ì‹ 
      loadDetail(currentVersionId);
      // ëª©ë¡ë„ ê°±ì‹  í•„ìš” ì‹œ í˜¸ì¶œ (ì„ íƒ ì‚¬í•­)
      searchBtn.click();

    } catch (err) {
      console.error(err);
      alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜");
    }
  };


  // === DELETE BUTTON ===
  deleteBtn.onclick = async () => {
    if (!confirm("ì •ë§ ì´ ë²„ì „ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) return;

    try {
      const res = await fetch(`/api/admin/version/${currentVersionId}`, {
        method: "DELETE",
        headers: {
          "Authorization": `Bearer ${adminAccessToken}`
        }
      });

      if (!res.ok) {
        alert("ì‚­ì œ ì‹¤íŒ¨");
        return;
      }

      alert("ì‚­ì œ ì™„ë£Œ");
      closeDetailModal();
      searchBtn.click(); // ëª©ë¡ ê°±ì‹ 

    } catch (err) {
      console.error(err);
      alert("ì„œë²„ í†µì‹  ì˜¤ë¥˜");
    }
  };

</script>

</body>
</html>